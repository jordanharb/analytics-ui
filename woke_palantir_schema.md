-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.actor_classifier_views (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  filter_config jsonb NOT NULL,
  icon text DEFAULT 'üîç'::text,
  is_system boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_by text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT actor_classifier_views_pkey PRIMARY KEY (id)
);
CREATE TABLE public.actor_migration_map (
  old_table text NOT NULL,
  old_id uuid NOT NULL,
  new_actor_id uuid NOT NULL,
  CONSTRAINT actor_migration_map_pkey PRIMARY KEY (new_actor_id)
);
CREATE TABLE public.actor_usernames (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  actor_id uuid NOT NULL,
  actor_type text NOT NULL CHECK (actor_type = ANY (ARRAY['person'::text, 'organization'::text, 'chapter'::text])),
  platform text NOT NULL,
  username text NOT NULL,
  url text,
  verified boolean DEFAULT false,
  follower_count integer,
  last_active_date timestamp with time zone,
  is_primary boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  should_scrape boolean DEFAULT false,
  last_scrape timestamp with time zone,
  last_profile_update timestamp with time zone,
  CONSTRAINT actor_usernames_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ai_analysis_cache (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  content_id uuid NOT NULL,
  content_type text NOT NULL,
  content_embedding USER-DEFINED,
  analysis_type text NOT NULL,
  analysis_result jsonb,
  confidence_score numeric,
  model_used text,
  processed_at timestamp with time zone DEFAULT now(),
  source_updated_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT ai_analysis_cache_pkey PRIMARY KEY (id)
);
CREATE TABLE public.az_legislative_districts (
  ld_number integer NOT NULL,
  centroid_lat numeric NOT NULL,
  centroid_lon numeric NOT NULL,
  cities ARRAY DEFAULT '{}'::text[],
  county ARRAY DEFAULT '{}'::text[],
  CONSTRAINT az_legislative_districts_pkey PRIMARY KEY (ld_number)
);
CREATE TABLE public.canonical_circulators (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  canonical_name text NOT NULL,
  canonical_address text NOT NULL,
  canonical_city text,
  canonical_state text,
  canonical_zip text,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT canonical_circulators_pkey PRIMARY KEY (id)
);
CREATE TABLE public.category_tags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tag_name text NOT NULL UNIQUE,
  tag_rule text,
  parent_tag text,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT category_tags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.chapter_institution_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  institution_slug text NOT NULL UNIQUE,
  chapter_id uuid,
  chapter_name text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT chapter_institution_links_pkey PRIMARY KEY (id),
  CONSTRAINT chapter_institution_links_chapter_id_fkey FOREIGN KEY (chapter_id) REFERENCES public.chapters(id)
);
CREATE TABLE public.chapters (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tpusa_id integer UNIQUE,
  name text NOT NULL,
  slug text,
  description text,
  email text,
  school_type text,
  state_code text,
  state_label text,
  city text,
  latitude numeric,
  longitude numeric,
  active_members integer,
  founded_year integer,
  patriot_point_total integer,
  officers jsonb,
  coordinator_name text,
  coordinator_email text,
  coordinator_phone text,
  coordinator_picture text,
  representative_name text,
  representative_email text,
  representative_phone text,
  representative_picture text,
  representative_twitter text,
  has_upcoming_events boolean DEFAULT false,
  has_past_events boolean DEFAULT false,
  should_scrape boolean DEFAULT false,
  status text DEFAULT 'active'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  x_profile_data jsonb,
  instagram_profile_data jsonb,
  last_profile_update timestamp with time zone,
  CONSTRAINT chapters_pkey PRIMARY KEY (id)
);
CREATE TABLE public.circulators (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  address character varying,
  city character varying,
  state character varying,
  zip character varying,
  name_normalized character varying,
  address_normalized character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  canonical_circulator_id uuid,
  mesa_district_2_resident boolean DEFAULT false,
  canonical_match_confidence text CHECK (canonical_match_confidence = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  CONSTRAINT circulators_pkey PRIMARY KEY (id),
  CONSTRAINT circulators_canonical_circulator_id_fkey FOREIGN KEY (canonical_circulator_id) REFERENCES public.canonical_circulators(id)
);
CREATE TABLE public.dynamic_slugs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  parent_tag text NOT NULL,
  slug_identifier text NOT NULL,
  full_slug text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  usage_count integer DEFAULT 1,
  CONSTRAINT dynamic_slugs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.event_actor_links (
  event_id uuid NOT NULL,
  actor_handle text NOT NULL,
  actor_type text,
  platform text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  actor_id uuid,
  updated_at timestamp with time zone,
  CONSTRAINT event_actor_links_pkey PRIMARY KEY (event_id, actor_handle, platform),
  CONSTRAINT fk_event FOREIGN KEY (event_id) REFERENCES public.events_retired(id)
);
CREATE TABLE public.event_post_links (
  event_id uuid NOT NULL,
  post_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT event_post_links_pkey PRIMARY KEY (event_id, post_id),
  CONSTRAINT fk_post FOREIGN KEY (post_id) REFERENCES public.social_media_posts(id),
  CONSTRAINT fk_event FOREIGN KEY (event_id) REFERENCES public.events_retired(id)
);
CREATE TABLE public.event_unknown_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_id uuid NOT NULL,
  unknown_actor_id uuid NOT NULL,
  relationship_type text NOT NULL CHECK (relationship_type = ANY (ARRAY['participant'::text, 'organizer'::text, 'mentioned'::text, 'tagged'::text])),
  confidence_score numeric DEFAULT 1.0,
  extraction_method text DEFAULT 'manual'::text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT event_unknown_actors_pkey PRIMARY KEY (id),
  CONSTRAINT event_unknown_actors_unknown_actor_id_fkey FOREIGN KEY (unknown_actor_id) REFERENCES public.unknown_actors(id),
  CONSTRAINT event_unknown_actors_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.events_retired(id)
);
CREATE TABLE public.events_retired (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_name text NOT NULL,
  event_date date,
  location text,
  city text,
  state text,
  participants text,
  justification text,
  category_tags jsonb,
  event_type text,
  source_post_ids jsonb,
  confidence_score numeric,
  associated_actors jsonb,
  instagram_handles jsonb,
  twitter_handles jsonb,
  extracted_by text DEFAULT 'gemini'::text,
  extracted_at timestamp with time zone DEFAULT now(),
  verified boolean DEFAULT false,
  verified_by text,
  verified_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  event_description text,
  latitude numeric,
  longitude numeric,
  CONSTRAINT events_retired_pkey PRIMARY KEY (id)
);
CREATE TABLE public.hashtags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  hashtag_text text NOT NULL UNIQUE,
  normalized_text text NOT NULL,
  first_seen_date timestamp with time zone DEFAULT now(),
  last_seen_date timestamp with time zone DEFAULT now(),
  total_usage_count integer DEFAULT 0,
  platforms jsonb DEFAULT '[]'::jsonb,
  is_trending boolean DEFAULT false,
  category text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT hashtags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.known_venues (
  venue_key text NOT NULL,
  display_name text,
  city text,
  state text,
  country text DEFAULT 'USA'::text,
  latitude numeric NOT NULL,
  longitude numeric NOT NULL,
  confidence numeric DEFAULT 0.98,
  CONSTRAINT known_venues_pkey PRIMARY KEY (venue_key)
);
CREATE TABLE public.location_aliases (
  raw_pattern text NOT NULL,
  normalized_city text,
  normalized_state text,
  normalized_country text,
  scope text,
  explode_into ARRAY,
  CONSTRAINT location_aliases_pkey PRIMARY KEY (raw_pattern)
);
CREATE TABLE public.location_coordinates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  city text,
  state text NOT NULL,
  country text DEFAULT 'USA'::text,
  location_type text NOT NULL CHECK (location_type = ANY (ARRAY['city'::text, 'state'::text, 'country'::text, 'venue'::text, 'district'::text, 'county'::text, 'region'::text, 'virtual'::text, 'unknown'::text])),
  latitude numeric NOT NULL,
  longitude numeric NOT NULL,
  geocoding_source text DEFAULT 'manual'::text,
  confidence_score numeric DEFAULT 1.00,
  last_verified timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT location_coordinates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.notable_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  detected_username text NOT NULL,
  platform text NOT NULL,
  twitter_handle text,
  instagram_handle text,
  reason_for_noting text,
  profile_displayname text,
  profile_bio text,
  profile_location text,
  noted_date timestamp with time zone DEFAULT now(),
  notes text,
  CONSTRAINT notable_actors_pkey PRIMARY KEY (id)
);
CREATE TABLE public.organizations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  type text,
  parent_organization text,
  summary_focus text,
  region_scope text,
  notes text,
  is_tpusa boolean DEFAULT false,
  should_scrape boolean DEFAULT false,
  status text DEFAULT 'active'::text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  x_profile_data jsonb,
  instagram_profile_data jsonb,
  last_profile_update timestamp with time zone,
  CONSTRAINT organizations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.people (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  full_name text,
  location text,
  city text,
  state text,
  region text,
  about text,
  present_role text,
  role_category text,
  role_history text,
  primary_organization_id uuid,
  division_text text,
  is_tpusa_staff boolean DEFAULT false,
  is_tpusa_affiliated boolean DEFAULT false,
  should_scrape boolean DEFAULT false,
  status text DEFAULT 'active'::text,
  discovery_date timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  x_profile_data jsonb,
  instagram_profile_data jsonb,
  last_profile_update timestamp with time zone,
  CONSTRAINT people_pkey PRIMARY KEY (id),
  CONSTRAINT people_primary_organization_id_fkey FOREIGN KEY (primary_organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.people_circulator_matches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  person_id text NOT NULL UNIQUE,
  circulator_id uuid NOT NULL,
  match_confidence character varying,
  match_type character varying,
  similarity_score double precision CHECK (similarity_score >= 0.0::double precision AND similarity_score <= 1.0::double precision),
  name_similarity double precision,
  location_similarity double precision,
  city_similarity double precision,
  state_similarity double precision,
  match_reasoning text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT people_circulator_matches_pkey PRIMARY KEY (id),
  CONSTRAINT people_circulator_matches_circulator_id_fkey FOREIGN KEY (circulator_id) REFERENCES public.circulators(id)
);
CREATE TABLE public.people_duplicate_groups (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_id uuid NOT NULL DEFAULT gen_random_uuid(),
  person_id uuid NOT NULL,
  similarity_score double precision CHECK (similarity_score >= 0.0::double precision AND similarity_score <= 1.0::double precision),
  match_reasoning text,
  is_canonical boolean DEFAULT false,
  canonical_priority_score double precision DEFAULT 0.0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT people_duplicate_groups_pkey PRIMARY KEY (id),
  CONSTRAINT people_duplicate_groups_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.people(id)
);
CREATE TABLE public.person_organizations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  person_id uuid NOT NULL,
  organization_id uuid NOT NULL,
  is_primary boolean DEFAULT false,
  role_in_organization text,
  start_date date,
  end_date date,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT person_organizations_pkey PRIMARY KEY (id),
  CONSTRAINT person_organizations_person_id_fkey FOREIGN KEY (person_id) REFERENCES public.people(id),
  CONSTRAINT person_organizations_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.petition_circulators (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  petition_id uuid,
  circulator_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  circulator_signed_date date,
  CONSTRAINT petition_circulators_pkey PRIMARY KEY (id),
  CONSTRAINT petition_circulators_circulator_id_fkey FOREIGN KEY (circulator_id) REFERENCES public.circulators(id),
  CONSTRAINT petition_circulators_petition_id_fkey FOREIGN KEY (petition_id) REFERENCES public.petitions(id)
);
CREATE TABLE public.petition_signatures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  petition_id uuid,
  signatory_id uuid,
  date_signed date,
  created_at timestamp with time zone DEFAULT now(),
  containment_score integer CHECK (containment_score IS NULL OR containment_score >= 0 AND containment_score <= 10),
  CONSTRAINT petition_signatures_pkey PRIMARY KEY (id),
  CONSTRAINT petition_signatures_petition_id_fkey FOREIGN KEY (petition_id) REFERENCES public.petitions(id),
  CONSTRAINT petition_signatures_signatory_id_fkey FOREIGN KEY (signatory_id) REFERENCES public.signatories(id)
);
CREATE TABLE public.petitions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  original_file_name character varying NOT NULL,
  county character varying,
  circulation_type character varying CHECK (circulation_type::text = ANY (ARRAY['paid'::character varying, 'volunteer'::character varying]::text[])),
  front_page_url text,
  back_page_url text,
  processing_status character varying DEFAULT 'pending'::character varying CHECK (processing_status::text = ANY (ARRAY['pending'::character varying, 'processing'::character varying, 'completed'::character varying, 'error'::character varying]::text[])),
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  petition_number_in_file integer,
  processing_worker_id text,
  CONSTRAINT petitions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.post_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  actor_id uuid NOT NULL,
  actor_type text NOT NULL CHECK (actor_type = ANY (ARRAY['person'::text, 'organization'::text, 'chapter'::text])),
  relationship_type text NOT NULL CHECK (relationship_type = ANY (ARRAY['author'::text, 'mentioned'::text, 'tagged'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_actors_pkey PRIMARY KEY (id),
  CONSTRAINT post_actors_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.social_media_posts(id)
);
CREATE TABLE public.post_hashtags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  hashtag_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_hashtags_pkey PRIMARY KEY (id),
  CONSTRAINT post_hashtags_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.social_media_posts(id),
  CONSTRAINT post_hashtags_hashtag_id_fkey FOREIGN KEY (hashtag_id) REFERENCES public.hashtags(id)
);
CREATE TABLE public.post_unknown_actors (
  id uuid NOT NULL,
  post_id uuid,
  unknown_actor_id uuid,
  relationship_type text CHECK (relationship_type = ANY (ARRAY['author'::text, 'mentioned'::text, 'tagged'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT post_unknown_actors_pkey PRIMARY KEY (id),
  CONSTRAINT post_unknown_actors_unknown_actor_id_fkey FOREIGN KEY (unknown_actor_id) REFERENCES public.unknown_actors(id),
  CONSTRAINT post_unknown_actors_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.social_media_posts(id)
);
CREATE TABLE public.scraping_jobs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_type text NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text,
  total_handles integer,
  completed_handles integer DEFAULT 0,
  current_handle text,
  started_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  error_log jsonb,
  console_logs jsonb DEFAULT '[]'::jsonb,
  control_signal text,
  worker_stats jsonb DEFAULT '{}'::jsonb,
  batch_progress jsonb DEFAULT '{}'::jsonb,
  subprocess_pid integer,
  CONSTRAINT scraping_jobs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.scraping_sessions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_type text NOT NULL,
  start_time timestamp with time zone DEFAULT now(),
  end_time timestamp with time zone,
  status text DEFAULT 'running'::text,
  platforms jsonb,
  date_range_start date,
  date_range_end date,
  posts_processed integer DEFAULT 0,
  events_extracted integer DEFAULT 0,
  new_actors_discovered integer DEFAULT 0,
  profiles_updated integer DEFAULT 0,
  error_count integer DEFAULT 0,
  error_log jsonb,
  configuration jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT scraping_sessions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.signatories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  address character varying,
  city character varying,
  zip character varying,
  name_normalized character varying,
  address_normalized character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  matched_voter_id uuid,
  match_confidence numeric,
  match_method character varying,
  is_verified_voter boolean DEFAULT false,
  verification_notes text,
  distance_from_voter_miles numeric,
  matched_name text,
  matched_address text,
  containment_score double precision CHECK (containment_score IS NULL OR containment_score >= 0::double precision AND containment_score <= 10::double precision),
  voter_similarity_score numeric CHECK (voter_similarity_score >= 0.0 AND voter_similarity_score <= 1.0),
  voter_match_confidence text CHECK (voter_match_confidence = ANY (ARRAY['high'::text, 'medium'::text, 'low'::text])),
  voter_match_reasoning text,
  voter_match_type text,
  CONSTRAINT signatories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.signatory_voter_matches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  signatory_id uuid NOT NULL UNIQUE,
  voter_id text NOT NULL,
  match_confidence character varying,
  match_type character varying,
  similarity_score double precision CHECK (similarity_score >= 0.0::double precision AND similarity_score <= 1.0::double precision),
  match_reasoning text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT signatory_voter_matches_pkey PRIMARY KEY (id),
  CONSTRAINT signatory_voter_matches_signatory_id_fkey FOREIGN KEY (signatory_id) REFERENCES public.signatories(id)
);
CREATE TABLE public.social_media_posts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id text NOT NULL,
  platform text NOT NULL CHECK (platform = ANY (ARRAY['instagram'::text, 'twitter'::text, 'tiktok'::text, 'youtube'::text, 'calendar'::text])),
  post_url text,
  author_handle text,
  author_name text,
  content_text text,
  post_timestamp timestamp with time zone,
  media_urls jsonb,
  media_count integer DEFAULT 0,
  like_count integer DEFAULT 0,
  reply_count integer DEFAULT 0,
  share_count integer DEFAULT 0,
  mentioned_users jsonb,
  hashtags jsonb,
  location text,
  preprocessed_at timestamp with time zone DEFAULT now(),
  processed_for_events boolean DEFAULT false,
  linked_actor_id uuid,
  linked_actor_type text,
  created_at timestamp with time zone DEFAULT now(),
  event_processed_at timestamp with time zone,
  offline_image_url text,
  screenshot_url text,
  CONSTRAINT social_media_posts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.unknown_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  detected_username text NOT NULL,
  platform text NOT NULL,
  first_seen_date timestamp with time zone DEFAULT now(),
  mention_context text,
  source_post_id text,
  review_status text DEFAULT 'pending'::text,
  assigned_actor_type text,
  assigned_actor_id uuid,
  reviewed_by text,
  reviewed_at timestamp with time zone,
  x_profile_data jsonb,
  instagram_profile_data jsonb,
  created_at timestamp with time zone DEFAULT now(),
  profile_url text,
  mention_count integer DEFAULT 1,
  last_seen_date timestamp with time zone,
  latest_post_id text,
  author_count integer DEFAULT 0,
  profile_displayname text,
  profile_bio text,
  profile_location text,
  last_profile_update timestamp with time zone,
  CONSTRAINT unknown_actors_pkey PRIMARY KEY (id)
);
CREATE TABLE public.usps_state_map (
  abbr text NOT NULL,
  name text NOT NULL,
  alt_names ARRAY NOT NULL DEFAULT '{}'::text[],
  CONSTRAINT usps_state_map_pkey PRIMARY KEY (abbr)
);
CREATE TABLE public.v2_actor_links (
  from_actor_id uuid NOT NULL,
  to_actor_id uuid NOT NULL,
  start_date date,
  end_date date,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  is_primary boolean DEFAULT false,
  role text,
  role_category text,
  relationship text,
  CONSTRAINT actor_links_from_actor_id_fkey FOREIGN KEY (from_actor_id) REFERENCES public.v2_actors(id),
  CONSTRAINT actor_links_to_actor_id_fkey FOREIGN KEY (to_actor_id) REFERENCES public.v2_actors(id)
);
CREATE TABLE public.v2_actor_type_field_mappings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  actor_type_id uuid,
  field_name text NOT NULL,
  column_name text NOT NULL,
  data_type text NOT NULL,
  is_indexed boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT v2_actor_type_field_mappings_pkey PRIMARY KEY (id),
  CONSTRAINT v2_actor_type_field_mappings_actor_type_id_fkey FOREIGN KEY (actor_type_id) REFERENCES public.v2_actor_types(id)
);
CREATE TABLE public.v2_actor_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  name text NOT NULL,
  schema_fields jsonb NOT NULL,
  indexed_fields jsonb DEFAULT '[]'::jsonb,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT v2_actor_types_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_actor_usernames (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  actor_id uuid NOT NULL,
  actor_type text NOT NULL,
  platform text NOT NULL,
  username text NOT NULL,
  url text,
  verified boolean DEFAULT false,
  follower_count integer,
  last_active_date timestamp with time zone,
  is_primary boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  should_scrape boolean DEFAULT false,
  last_scrape timestamp with time zone,
  last_profile_update timestamp with time zone,
  CONSTRAINT v2_actor_usernames_pkey PRIMARY KEY (id),
  CONSTRAINT v2_actor_usernames_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES public.v2_actors(id)
);
CREATE TABLE public.v2_actors (
  id uuid NOT NULL,
  actor_type text NOT NULL CHECK (actor_type = ANY (ARRAY['person'::text, 'organization'::text, 'chapter'::text])),
  name text NOT NULL,
  city text,
  state text,
  data jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  actor_type_id uuid,
  custom_text_1 text,
  custom_text_2 text,
  custom_text_3 text,
  custom_text_4 text,
  custom_text_5 text,
  custom_text_6 text,
  custom_text_7 text,
  custom_text_8 text,
  custom_text_9 text,
  custom_text_10 text,
  custom_numeric_1 numeric,
  custom_numeric_2 numeric,
  custom_numeric_3 numeric,
  custom_numeric_4 numeric,
  custom_numeric_5 numeric,
  custom_date_1 date,
  custom_date_2 date,
  custom_date_3 date,
  custom_bool_1 boolean,
  custom_bool_2 boolean,
  should_scrape boolean DEFAULT true,
  x_profile_data jsonb,
  instagram_profile_data jsonb,
  last_profile_update timestamp with time zone,
  about text,
  region text,
  truth_social_profile_data jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT v2_actors_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_batches (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  job_type text NOT NULL DEFAULT 'event_processing'::text,
  status text NOT NULL DEFAULT 'pending'::text,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  total_posts integer DEFAULT 0,
  posts_processed integer DEFAULT 0,
  events_extracted integer DEFAULT 0,
  message text,
  current_batch integer DEFAULT 0,
  total_batches integer DEFAULT 0,
  console_output jsonb DEFAULT '[]'::jsonb,
  worker_stats jsonb DEFAULT '{}'::jsonb,
  batch_progress jsonb DEFAULT '{}'::jsonb,
  control_signal text,
  subprocess_pid integer,
  error_log jsonb,
  error_count integer DEFAULT 0,
  config jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  accounts_scraped bigint,
  total_accounts bigint,
  CONSTRAINT v2_batches_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_event_actor_links (
  event_id uuid NOT NULL,
  actor_handle text NOT NULL,
  actor_type text,
  platform text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  actor_id uuid,
  updated_at timestamp with time zone,
  unknown_actor_id uuid,
  CONSTRAINT v2_event_actor_links_pkey PRIMARY KEY (event_id, actor_handle, platform),
  CONSTRAINT v2_event_actor_links_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.v2_events(id),
  CONSTRAINT v2_event_actor_links_unknown_actor_id_fkey FOREIGN KEY (unknown_actor_id) REFERENCES public.v2_unknown_actors(id),
  CONSTRAINT v2_event_actor_links_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES public.v2_actors(id)
);
CREATE TABLE public.v2_event_denorm (
  event_id uuid NOT NULL,
  event_date date,
  project_id uuid,
  city text,
  state text,
  latitude numeric,
  longitude numeric,
  confidence_score numeric,
  verified boolean,
  tags ARRAY NOT NULL DEFAULT '{}'::text[],
  institutions ARRAY NOT NULL DEFAULT '{}'::text[],
  actor_ids ARRAY NOT NULL DEFAULT '{}'::uuid[],
  people_ids ARRAY NOT NULL DEFAULT '{}'::uuid[],
  org_ids ARRAY NOT NULL DEFAULT '{}'::uuid[],
  chapter_ids ARRAY NOT NULL DEFAULT '{}'::uuid[],
  post_count integer NOT NULL DEFAULT 0,
  CONSTRAINT v2_event_denorm_pkey PRIMARY KEY (event_id),
  CONSTRAINT v2_event_denorm_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.v2_events(id)
);
CREATE TABLE public.v2_event_denorm_refresh_queue (
  event_id uuid NOT NULL,
  enqueued_at timestamp with time zone NOT NULL DEFAULT now(),
  processed_at timestamp with time zone,
  CONSTRAINT v2_event_denorm_refresh_queue_pkey PRIMARY KEY (event_id)
);
CREATE TABLE public.v2_event_post_links (
  event_id uuid NOT NULL,
  post_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT v2_event_post_links_pkey PRIMARY KEY (event_id, post_id),
  CONSTRAINT v2_event_post_links_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.v2_social_media_posts(id),
  CONSTRAINT v2_event_post_links_event_id_fkey FOREIGN KEY (event_id) REFERENCES public.v2_events(id)
);
CREATE TABLE public.v2_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_name text NOT NULL,
  event_date date,
  location text,
  city text,
  state text,
  participants text,
  justification text,
  category_tags jsonb,
  event_type text,
  source_post_ids jsonb,
  confidence_score numeric,
  associated_actors jsonb,
  instagram_handles jsonb,
  twitter_handles jsonb,
  extracted_by text DEFAULT 'gemini'::text,
  extracted_at timestamp with time zone DEFAULT now(),
  verified boolean DEFAULT false,
  verified_by text,
  verified_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  event_description text,
  latitude numeric,
  longitude numeric,
  project_id uuid,
  content_hash character varying UNIQUE,
  embedding USER-DEFINED,
  CONSTRAINT v2_events_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_hashtag_platforms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  hashtag_id uuid NOT NULL,
  platform text NOT NULL,
  first_seen timestamp with time zone NOT NULL DEFAULT now(),
  last_seen timestamp with time zone NOT NULL DEFAULT now(),
  usage_count integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT v2_hashtag_platforms_pkey PRIMARY KEY (id),
  CONSTRAINT v2_hashtag_platforms_hashtag_id_fkey FOREIGN KEY (hashtag_id) REFERENCES public.v2_hashtags(id)
);
CREATE TABLE public.v2_hashtags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  hashtag_text text NOT NULL UNIQUE,
  normalized_text text NOT NULL,
  first_seen_date timestamp with time zone NOT NULL DEFAULT now(),
  last_seen_date timestamp with time zone NOT NULL DEFAULT now(),
  total_usage_count integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT v2_hashtags_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_post_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  actor_id uuid NOT NULL,
  actor_type text NOT NULL,
  relationship_type text NOT NULL CHECK (relationship_type = ANY (ARRAY['author'::text, 'mentioned'::text, 'tagged'::text])),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT v2_post_actors_pkey PRIMARY KEY (id),
  CONSTRAINT v2_post_actors_post_id_fkey FOREIGN KEY (post_id) REFERENCES public.v2_social_media_posts(id),
  CONSTRAINT v2_post_actors_actor_id_fkey FOREIGN KEY (actor_id) REFERENCES public.v2_actors(id)
);
CREATE TABLE public.v2_post_hashtags (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  hashtag_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT v2_post_hashtags_pkey PRIMARY KEY (id),
  CONSTRAINT fk_post_hashtags_post FOREIGN KEY (post_id) REFERENCES public.v2_social_media_posts(id),
  CONSTRAINT v2_post_hashtags_hashtag_id_fkey FOREIGN KEY (hashtag_id) REFERENCES public.v2_hashtags(id)
);
CREATE TABLE public.v2_post_unknown_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id uuid NOT NULL,
  unknown_actor_id uuid NOT NULL,
  mention_context text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT v2_post_unknown_actors_pkey PRIMARY KEY (id),
  CONSTRAINT v2_post_unknown_actors_unknown_actor_id_fkey FOREIGN KEY (unknown_actor_id) REFERENCES public.v2_unknown_actors(id)
);
CREATE TABLE public.v2_projects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  config jsonb DEFAULT '{}'::jsonb,
  created_by text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT v2_projects_pkey PRIMARY KEY (id)
);
CREATE TABLE public.v2_social_media_posts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  post_id text NOT NULL UNIQUE,
  platform text NOT NULL CHECK (platform = ANY (ARRAY['instagram'::text, 'twitter'::text, 'tiktok'::text, 'youtube'::text, 'calendar'::text, 'telegram'::text, 'facebook'::text, 'gab'::text, 'truth_social'::text])),
  post_url text,
  author_handle text,
  author_name text,
  content_text text,
  post_timestamp timestamp with time zone,
  media_urls jsonb,
  media_count integer DEFAULT 0,
  like_count integer DEFAULT 0,
  reply_count integer DEFAULT 0,
  share_count integer DEFAULT 0,
  mentioned_users jsonb,
  hashtags jsonb,
  location text,
  preprocessed_at timestamp with time zone DEFAULT now(),
  processed_for_events boolean DEFAULT false,
  linked_actor_id uuid,
  linked_actor_type text,
  created_at timestamp with time zone DEFAULT now(),
  event_processed_at timestamp with time zone,
  offline_image_url text,
  screenshot_url text,
  project_id uuid,
  other_data jsonb,
  assigned_to_batch uuid,
  assigned_at timestamp with time zone,
  CONSTRAINT v2_social_media_posts_pkey PRIMARY KEY (id),
  CONSTRAINT v2_social_media_posts_linked_actor_fkey FOREIGN KEY (linked_actor_id) REFERENCES public.v2_actors(id)
);
CREATE TABLE public.v2_unknown_actor_link_queue (
  unknown_id uuid NOT NULL,
  target_actor_id uuid NOT NULL,
  platform text NOT NULL,
  username text NOT NULL,
  updated_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT v2_unknown_actor_link_queue_pkey PRIMARY KEY (unknown_id)
);
CREATE TABLE public.v2_unknown_actors (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  detected_username text NOT NULL,
  platform text NOT NULL,
  first_seen_date timestamp with time zone DEFAULT now(),
  last_seen_date timestamp with time zone NOT NULL DEFAULT now(),
  mention_context text,
  mention_count integer DEFAULT 1,
  author_count integer DEFAULT 1,
  review_status text DEFAULT 'pending'::text,
  assigned_actor_type text,
  assigned_actor_id uuid,
  profile_displayname text,
  profile_bio text,
  profile_location text,
  follower_count integer,
  verified boolean DEFAULT false,
  x_profile_data jsonb DEFAULT '{}'::jsonb,
  instagram_profile_data jsonb DEFAULT '{}'::jsonb,
  tiktok_profile_data jsonb DEFAULT '{}'::jsonb,
  youtube_profile_data jsonb DEFAULT '{}'::jsonb,
  data jsonb DEFAULT '{}'::jsonb,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  truth_social_profile_data jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT v2_unknown_actors_pkey PRIMARY KEY (id)
);
CREATE TABLE public.virtual_location_keywords (
  keyword text NOT NULL,
  CONSTRAINT virtual_location_keywords_pkey PRIMARY KEY (keyword)
);
CREATE TABLE public.voters (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  registration_id character varying NOT NULL UNIQUE,
  last_name character varying,
  first_name character varying,
  middle_name character varying,
  name_suffix character varying,
  full_name text DEFAULT TRIM(BOTH FROM (((((first_name)::text || ' '::text) || COALESCE(((middle_name)::text || ' '::text), ''::text)) || (last_name)::text) || COALESCE((' '::text || (name_suffix)::text), ''::text))),
  name_normalized text,
  date_of_registration timestamp with time zone,
  effective_date_of_registration timestamp with time zone,
  residence_street_address text,
  residence_city character varying,
  residence_state character varying,
  residence_zip character varying,
  address_normalized text,
  mailing_street_address text,
  mailing_city character varying,
  mailing_state character varying,
  mailing_zip character varying,
  party character varying,
  phone character varying,
  year_of_birth integer,
  status character varying,
  general_2024 boolean DEFAULT false,
  primary_2025 boolean DEFAULT false,
  general_2022 boolean DEFAULT false,
  primary_2024 boolean DEFAULT false,
  general_2020 boolean DEFAULT false,
  primary_2022 boolean DEFAULT false,
  active_early_voting boolean DEFAULT false,
  precinct_number character varying,
  city_district character varying,
  school_district character varying,
  highschool_district character varying,
  fire_district character varying,
  technical_district character varying,
  sanitation_district character varying,
  congressional_district character varying,
  legislative_district character varying,
  justiceofthepeace_district character varying,
  supervisory_district character varying,
  maricopacountycommunitycollege_district character varying,
  military_address_1 text,
  military_address_2 text,
  military_address_3 text,
  military_address_4 text,
  uocava boolean DEFAULT false,
  federal boolean DEFAULT false,
  latitude numeric,
  longitude numeric,
  geocoded_address text,
  geocoding_confidence numeric,
  name_embedding USER-DEFINED,
  address_embedding USER-DEFINED,
  combined_embedding USER-DEFINED,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT voters_pkey PRIMARY KEY (id)
);
CREATE TABLE public.wrappers_fdw_stats (
  fdw_name text NOT NULL,
  create_times bigint,
  rows_in bigint,
  rows_out bigint,
  bytes_in bigint,
  bytes_out bigint,
  metadata jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT wrappers_fdw_stats_pkey PRIMARY KEY (fdw_name)
);